#!/bin/bash

# Display listening ports with PID and program name

echo "Active Internet connections (only servers)"
echo "Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name"

# Display TCP listening ports
echo "tcp:"
netstat -tuln | grep 'tcp' | awk '{print $1,$4,$5,$6}' | while read -r protocol local foreign state; do
    pid=$(lsof -i -n -P | grep LISTEN | grep "$protocol.*$local" | awk '{print $2}')
    program=$(ps -p "$pid" -o comm=)
    echo "$protocol     $local     $foreign     $state     $pid/$program"
done

# Display UDP listening ports
echo "udp:"
netstat -uln | grep 'udp' | awk '{print $1,$4,"*:*",$6}' | while read -r protocol local state; do
    pid=$(lsof -i -n -P | grep UDP | grep "$protocol.*$local" | awk '{print $2}')
    program=$(ps -p "$pid" -o comm=)
    echo "$protocol     $local     $state     $pid/$program"
done

echo "Active UNIX domain sockets (only servers)"
echo "Proto RefCnt Flags       Type       State         I-Node   PID/Program name    Path"

# Display UNIX domain sockets
netstat -lx | grep 'unix' | awk '{print $1,$2,$3,$4,$5}' | while read -r protocol refcnt flags type state inode; do
    pid=$(lsof -U -n | grep "$inode" | awk '{print $2}')
    program=$(ps -p "$pid" -o comm=)
    path=$(echo "$state" | awk '{print $NF}')
    echo "$protocol  $refcnt   $flags     $type     $state     $inode   $pid/$program   $path"
done


