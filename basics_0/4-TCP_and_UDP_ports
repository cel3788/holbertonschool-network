#!/bin/bash

# Display listening ports with PID and program name

echo "Active Internet connections (only servers)"
echo "Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name"

# Display TCP listening ports
netstat -tuln | grep 'tcp' | awk '{print $1,$4,$5,$6}' | while read -r protocol local foreign state; do
    pid=$(lsof -i -n -P | grep LISTEN | grep "$protocol.*$local" | awk '{print $2}')
    program=$(ps -p "$pid" -o comm=)
    echo "$protocol     $local     $foreign     $state     $pid/$program"
done

# Display UDP listening ports
netstat -uln | grep 'udp' | awk '{print $1,$4,"*:*",$6}' | while read -r protocol local state; do
    pid=$(lsof -i -n -P | grep UDP | grep "$protocol.*$local" | awk '{print $2}')
    program=$(ps -p "$pid" -o comm=)
    echo "$protocol     $local     $state     $pid/$program"
done
